<% layout('manager/layout') %>
<section class="content">
    <div class="container-fluid">
        <div class="row">
            <div class="col-lg-12">
                <div class="view-header">

                    <div class="header-icon">
                        <i class="pe page-header-icon pe-7s-menu"></i>
                    </div>
                    <div class="header-title">
                        <h3><%=title%></h3>
                        <small>
                            <%=title%>
                        </small>
                    </div>
                </div>
                <hr>
            </div>
        </div>
        <div class="row">
            <div class="col-lg-12">
                <div class="panel panel-filled">
                    <div class="panel-heading">
                        <div class="panel-tools">
                            <a href="javascript:;" class="btn btn-w-md btn-accent"  onclick="onWriteSubmit();">저장하기</a>
                            <!-- <a class="panel-toggle"><i class="fa fa-chevron-up"></i></a>
                             <a class="panel-close"><i class="fa fa-times"></i></a>-->
                        </div>
                        기본정보 수정
                    </div>
                    <form method="post" name="writeForm" id="writeForm" enctype="multipart/form-data">
                        <input type="hidden" name="cmp_idx" id="cmp_idx" value="<%=rows.cmp_idx%>">
                        <input type="hidden" name="cmp_id" id="cmp_id" value="<%=rows.cmp_id%>">
                        <input type="hidden" name="f_img" id="f_img" value="<%=rows.cmp_logo_image%>"/>    

                        <div class="panel-body">

                            <div class="row show-grid">
                                <div class="col-md-2">관리자ID</div>
                                <div class="col-md-4"><%=rows.cmp_id%></div>
                                <div class="col-md-2"><i class="fa fa-star-o" aria-hidden="true"></i>관리자패스워드</div>
                                <div class="col-md-4"><a href="javascript:;" class="btn btn-w-md btn-accent"  onclick="onPwdWindow();">패스워드 변경</a></div>
                            </div>
                            <!--<div class="row show-grid">-->
                                <!--<div class="col-md-2"><i class="fa fa-star-o" aria-hidden="true"></i>업체명</div>-->
                                <!--<div class="col-md-4"><input type="text" class="form-control" name="cmp_name" id="cmp_name" value="<%=rows.cmp_name%>"></div>-->
                                <!--<div class="col-md-2"><i class="fa fa-star-o" aria-hidden="true"></i>사업자번호</div>-->
                                <!--<div class="col-md-4"><input type="text" class="form-control" name="cmp_number" id="cmp_number" value="<%=rows.cmp_number%>"></div>-->
                            <!--</div>-->
                            <!--<div class="row show-grid">-->
                                <!--<div class="col-md-2"><i class="fa fa-star-o" aria-hidden="true"></i>대표자명</div>-->
                                <!--<div class="col-md-4"><input type="text" class="form-control" name="cmp_ceo_name" id="cmp_ceo_name" value="<%=rows.cmp_ceo_name%>"></div>-->
                                <!--<div class="col-md-2"><i class="fa fa-star-o" aria-hidden="true"></i>대표이메일</div>-->
                                <!--<div class="col-md-4"><input type="text" class="form-control" name="cmp_email" id="cmp_email" value="<%=rows.cmp_email%>"></div>-->
                            <!--</div>-->
                            <!--<div class="row show-grid">-->
                                <!--<div class="col-md-2"><i class="fa fa-star-o" aria-hidden="true"></i>연락처</div>-->
                                <!--<div class="col-md-4"><input type="text" class="form-control" name="cmp_phone" id="cmp_phone" value="<%=rows.cmp_phone%>"></div>-->
                                <!--<div class="col-md-2">팩스번호</div>-->
                                <!--<div class="col-md-4"><input type="text" class="form-control" name="cmp_fax" id="cmp_fax" value="<%=rows.cmp_fax%>"></div>-->
                            <!--</div>-->
                            <!--<div class="row show-grid">-->
                                <!--<div class="col-md-2">업체주소</div>-->
                                <!--<div class="col-md-10"><input type="text" class="form-control" name="cmp_address" id="cmp_address" value="<%=rows.cmp_address%>"></div>-->
                            <!--</div>-->
                            <div class="row show-grid">
                                <div class="col-md-2" style="height: 134px;">일반회원 약관</div>
                                <div class="col-md-10"><textarea class="form-control" rows="5" name="cmp_notice" id="cmp_notice" placeholder="일반회원 약관."><%=rows.cmp_notice%></textarea></div>
                            </div>
                            <div class="row show-grid">
                                <div class="col-md-2" style="height: 134px;">제휴회원 약관</div>
                                <div class="col-md-10"><textarea class="form-control" rows="5" name="cmp_text1" id="cmp_text1" placeholder="제휴회원 약관."><%=rows.cmp_text1%></textarea></div>
                            </div>
                           <!-- <div class="row show-grid">
                                <div class="col-md-2" style="height: 134px;">이용약관</div>
                                <div class="col-md-10"><textarea class="form-control" rows="5" name="cmp_text1" id="cmp_text1" placeholder="이용약관을 입력하세요."><%=rows.cmp_text1%></textarea></div>
                            </div>
                            <div class="panel-tools">
                                <a href="javascript:;" class="btn btn-w-md btn-accent" onclick="onWriteSubmit();">저장하기</a>
                                <!--<a href="#" class="btn btn-w-md btn-accent" data-toggle="modal" data-target="#myModal3">회원탈퇴</a>-->
                                <!-- <a class="panel-toggle"><i class="fa fa-chevron-up"></i></a>
                                 <a class="panel-close"><i class="fa fa-times"></i></a>-->
                            </div>
                        </div>
                    </form>
                </div>
            </div>

        </div>
        <div class="modal fade" id="myModal2" tabindex="-1" role="dialog" aria-hidden="true" style="display: none;">
            <div class="modal-dialog modal-sm">
                <div class="modal-content">
                    <div class="panel-body">
                        <form method="post" name="pwdForm" id="pwdForm">
                            <input type="hidden" name="cmp_idx" id="cmp_idx" value="<%=rows.cmp_idx%>">
                            <div class="form-group"><label for="re_pwd">이전 패스워드</label> <input type="password" class="form-control" name="re_pwd" id="re_pwd" placeholder=""></div>
                            <div class="form-group"><label for="new_pwd">신규 패스워드</label> <input type="password" class="form-control" name="new_pwd" id="new_pwd" placeholder=""></div>
                            <div class="form-group"><label for="new_pwd1">신규 패스워드 확인</label> <input type="password" class="form-control" name="new_pwd1" id="new_pwd1" placeholder=""></div>

                            <button type="button" onclick="onChangePwd();" class="btn btn-default">변경하기</button>
                            <button type="button" class="btn btn-default" data-dismiss="modal">닫기</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
 <!--   <div class="modal fade" id="myModal3" tabindex="-1" role="dialog" aria-hidden="true" style="display: none;">
        <div class="modal-dialog modal-sm">
            <div class="modal-content">
                <div class="modal-header text-center">
                    <h4 class="modal-title">회원탈퇴</h4>
                    <small>정말 탈퇴하시겠습니까?</small>
                </div>
                <div class="modal-body">
                    <p>회원탈퇴를 하시면 개인정보 및 <br/>사용하셨던 데이타들이 <br/>모두 삭제됩니다.(결제내역 제외)</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">닫기</button>
                    <button type="button" onclick="onMemberOut()" class="btn btn-accent">탈퇴하기</button>
                </div>
            </div>
        </div>
    </div>-->
</section>
<script>
    var reload = function(){
        location.reload();
    }

    var re = /^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;

    function onPwdWindow() {

        $('#re_pwd').val("");
        $('#new_pwd').val("");
        $('#new_pwd1').val("");

        $('#myModal2').modal('show');

    }


    function onChangePwd() {

        if ( $("#re_pwd").val().trim() == "" )
        {
            var message = "이전 비밀번호를 입력해 주세요";
            $("#re_pwd").val("");
            $("#re_pwd").focus();
            toastr.error(message);
            return false;
        }

        if ( $("#new_pwd").val().trim() == "" )
        {
            var message = "신규 비밀번호를 입력해 주세요";
            $("#new_pwd").val("");
            $("#new_pwd").focus();
            toastr.error(message);
            return false;
        }

        if ( $("#new_pwd1").val().trim() == "" )
        {
            var message = "신규 비밀번호 확인을 입력해 주세요";
            $("#new_pwd1").val("");
            $("#new_pwd1").focus();
            toastr.error(message);
            return false;
        }

        if( $('#new_pwd').val().trim() != $('#new_pwd1').val().trim()){
            var message = "비밀번호가 같지 않습니다";
            $("#new_pwd").val("");
            $("#new_pwd1").val("");
            $("#new_pwd").focus();
            toastr.error(message);
            return false;

        }

        if(!/^[a-zA-Z0-9]{8,16}$/.test($("#new_pwd1").val().trim())){
            var message = "패스워드는 영문,숫자 포함 8자리~16자리를 입력하셔야 합니다";
            $("#new_pwd").val("");
            $("#new_pwd1").val("");
            $("#new_pwd").focus();
            toastr.error(message);
            return false;
        }

        var url = "/manager/company/pwdChange";

        $("form[name='pwdForm']").attr("target","_self");
        $("form[name='pwdForm']").attr("action", url);
        $("form[name='pwdForm']").ajaxSubmit({
            success : function(data){
                if(data == 'success'){
                    toastr.success('변경되었습니다!');
                    $('#myModal2').modal('toggle');
                }else{
                    toastr.error('패스워드를 확인해주세요');
                }
            }
            ,error : function(e) {
                toastr.error('오류가 발생했습니다!');
            }
        });
    }


   /* function onMemberOut() {


        var url = "/companyOut";

        $("form[name='pwdForm']").attr("target","_self");
        $("form[name='pwdForm']").attr("action", url);
        $("form[name='pwdForm']").ajaxSubmit({
            success : function(data){
                if(data == 'success'){
                    toastr.success('탈퇴처리가 완료되었습니다!');
                    $('#myModal2').modal('toggle');
                    location.href="";
                }else{
                    toastr.error('오류가 발생했습니다!');
                }
            }
            ,error : function(e) {
                toastr.error('오류가 발생했습니다!');
            }
        });


    }*/

    function onWriteSubmit()
    {

        // if ( $("#cmp_name").val().trim() == "" )
        // {
        //     var message = "업체명을 입력해 주세요";
        //     $("#cmp_name").val("");
        //     $("#cmp_name").focus();
        //     toastr.error(message);
        //     return false;
        // }
        //
        // if ( $("#cmp_number").val().trim() == "" )
        // {
        //     var message = "사업자번호를 입력해 주세요";
        //     $("#cmp_number").val("");
        //     $("#cmp_number").focus();
        //     toastr.error(message);
        //     return false;
        // }
        //
        // if ( $("#cmp_ceo_name").val().trim() == "" )
        // {
        //     var message = "대표자명을 입력해 주세요";
        //     $("#cmp_ceo_name").val("");
        //     $("#cmp_ceo_name").focus();
        //     toastr.error(message);
        //     return false;
        // }
        //
        // if ( $("#cmp_email").val().trim() == "" )
        // {
        //     var message = "대표 이메일을 입력해 주세요";
        //     $("#cmp_email").val("");
        //     $("#cmp_email").focus();
        //     toastr.error(message);
        //     return false;
        // }
        //
        // if ( $("#cmp_phone").val().trim() == "" )
        // {
        //     var message = "대표 연락처를 입력해 주세요";
        //     $("#cmp_phone").val("");
        //     $("#cmp_phone").focus();
        //     toastr.error(message);
        //     return false;
        // }


        var url = "/manager/company/update";

        $("form[name='writeForm']").attr("target","_self");
        $("form[name='writeForm']").attr("action", url);
        $("form[name='writeForm']").attr("method","post");
        $("form[name='writeForm']").ajaxSubmit({
            success : function(data){
                if(data == 'success'){
                    toastr.success('저장되었습니다!');
                    setTimeout(reload, 1000);
                }else{
                    toastr.error('오류가 발생했습니다!');
                }
            }
            ,error : function(e) {
                toastr.error('오류가 발생했습니다!');
            }
        });

    }
    
    function showBg(img) {

        $("#imgDiv").html('');
        $("#imgDiv").html('<img src="'+img+'" style="display:block;width:100%;height:100%">');


        $('#myModal3').modal('show');
    }
</script>